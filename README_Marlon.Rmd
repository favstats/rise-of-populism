---
title: "Rise of Populism"
output: github_document
---

```{r, echo=F, warning=F, message=F}
load("data/populist_parties.Rdata")

pacman::p_load(tidyverse, writexl, haven, sjPlot, sjmisc, texreg, car, psych, knitr, labelled, broom, magrittr, BaylorEdPsych, lmtest, tinytext, refinr)


populist_parties %>% 
 # select(party_cntry) %>% 
  mutate(link = paste0("[",party_name_english,"](", links,")")) %>% 
  select(link, party_name, party_cntry, family, cluster) %>% 
  knitr::kable()

#ches_pop2 %<>% 
#  mutate(party_name_english = str_replace_all(party_name_english, ";", ""))

#write_xlsx(populist_parties, 'data/populist_parties.xlsx')
```

# Populistische Parteien umkodieren

```{r, echo=F, warning=F, message=F}
load("data/populist_parties.Rdata")

populist_parties %>% 
  arrange(party_cntry)

ess <- haven::read_spss("data/ess_round8.sav")

#ess_1_7 <- haven::read_spss("C:/Users/Fabio/Google Drive/data/ess_1_7.sav")

ess5_7 <- haven::read_spss("C:/Users/Fabio/OneDrive/data/ess5_7.sav")

x <- c("NPD", "Socialist Party", "ACME PIZZA COMPANY", "acme pizza LLC")
key_collision_merge(x, dict = c("Nicks Pizza", "acme PIZZA inc"))
```

#IMPOTANT TO DO
#ESS7 anschauen und evtl. Länder, die im ESS8 nicht drin sind ins Dataset einfügen. 
#Deutschland noch zusammenschmeißen, da in Ost/West geteilt...@Fabio: Habs irgendwie nich rausgefunden wie man das gescheidig hinbekommt ;(

# Umkodierung
#Important: folgende Länder sind nicht im ESS enthalten:
Italien, Spanien, Portugal, Griechenland, Ungarn, Dänemark

#folgende Länder sind umkodiert:
UK, Österreich, Belgien, Niederlande, Bulgarien, Schweden, Estonia, Czech Republic, Ireland
```{r}
table(sjmisc::to_label(ess$prtvede1))

party_string <- c("prtvtbat",
                  "prtvtcbe",
                  "prtvtcfr",
                  "prtvtdpl",
                  "prtvtbgb",
                  "prtvtfnl",
                  "prtvtbse",
                  "prtvtdfi",
                  "prtvtfee",
                  "prtvtdcz",
                  "prtvede1",
                  "prtvede2",
                  "prtvtbie")

ess %<>% # alle Parteienvariablen mit ihren Labeln ausstatten
  mutate_at(.funs = to_label, .vars = party_string) 

ess %<>% 
  mutate(populism = case_when(
    #Österreich
    prtvtbat == "BZÖ" ~ "Illiberal Populism",
    prtvtbat == "FPÖ" ~ "Illiberal Populism",    
    prtvtbat == "Team Frank Stronach" ~ "Illiberal Populism",  
    
    #Belgium
    prtvtcbe == "Parti Populaire" ~ "Illiberal Populism",
    prtvtcbe == "PVDA+" ~ "Liberal Populism",
    prtvtcbe == "Vlaams Belang" ~ "Illiberal Populism",
    
    #Frankreich
    prtvtcfr == "FN (Front National)" ~ "Illiberal Populism",
    #PG, MPF, PCF und Ensamble fehlt
    
    #Poland
    prtvtdpl == "Law and Justice" ~ "Illiberal Populism",
    prtvtdpl == "Together Party" ~ "Illiberal Populism",
    
    #UK
    prtvtbgb == "Green Party" ~ "Liberal Populism",
    prtvtbgb == "UK Independence Party" ~ "Illiberal Populism",
    
    #Netherland
    prtvtfnl == "Socialist Party" ~ "Liberal Populism",
    prtvtfnl == "Party for Freedom" ~ "Illiberal Populism", 
    prtvtfnl == "Party for the Animals" ~ "Liberal Populism",
    prtvtfnl == "50PLUS" ~ "Liberal Populism",
    
    #Sweden
    prtvtbse == "FI (Feministiskt initiativ)" ~ "Liberal Populism",
    prtvtbse == "Piratpartiet" ~ "Liberal Populism", 
    prtvtbse == "Sverigedomkraterna" ~ "Illiberal Populism", 
    prtvtbse == "Vänsterpartiet" ~ "Liberal Populism",
    
    #Slovenia; SaS, SNS, OLaNO...I miss you
    #prtvtesi == 
      
    #Finland  
    prtvtdfi == "PS (Parti Socialiste)" ~ "Illiberal Populism",
    #VAS not there...still watching...
    
    #Estonia
    prtvtfee == "Erakond Eestimaa Rohelised" ~ "Liberal Populism",
    prtvtfee == "Eesti Vabaerakond" ~ "Liberal Populism",
    
    #Czech Republic
    prtvtdcz == "KSČM" ~ "Illiberal Populism",
    prtvtdcz == "ANO 2011" ~ "Liberal Populism",
    prtvtdcz == "Úsvit přímé demokracie Tomia Okamury" ~ "Illiberal Populism", 
    #SVOBODNI...I miss you
    
    #Deutschland
    prtvede1 == "NPD" ~ "Illiberal Populism",
    prtvede1 == "AfD" ~ "Illiberal Populism",
    prtvede1 == "Die Linke" ~ "Liberal Populism",
    prtvede1 == "Piratenpartei" ~ "Liberal Populism",
    #Deutschland
    prtvede2 == "NPD" ~ "Illiberal Populism",
    prtvede2 == "AfD" ~ "Illiberal Populism",
    prtvede2 == "Die Linke" ~ "Liberal Populism",
    prtvede2 == "Piratenpartei" ~ "Liberal Populism",
    #Die Tierpartei not included
      
    #Ireland
    prtvtbie == "Green Party" ~ "Liberal Populism",
    prtvtbie == "Sinn Féin" ~ "Liberal Populism",
    prtvtbie == "Anti-Austerity Alliance - People Before Profit" ~ "Liberal Populism",
    #SP is missing
    TRUE ~ "Establishment"
   ))

#install.packages("refinr")

ignores <- c("be_", "dk_", "ge_", "gr_", "esp_", "fr_", "irl_", "it_", "nl_", "uk_", "por_", "aus_", "fin_", "sv_", "bul_", "cz_", "est_", "hun_", "lat_", "lith_", "pol_", "rom_", "slo_", "cro_", "cyp_")

populist_parties$party_cntry %>% 
  stringr::str_replace_all("_", "")
stringi::stri_sub(4) 
#refinr::key_collision_merge(ess, ignore_strings = ignores)

#install.packages('stringdist')

#stringdist::strinddist(ess, populist_parties)

table(ess$populism)
table(ess$cntry)
table(ess$prtvede2)
```

